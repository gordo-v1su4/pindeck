# Convex Deployment Configuration

Current deployment guidance for this repo.

## Deployments

| Environment | Deployment Name | URL |
|---|---|---|
| Development | `incredible-otter-369` | `https://incredible-otter-369.convex.cloud` |
| Production | `tremendous-jaguar-953` | `https://tremendous-jaguar-953.convex.site` |

Notes:
- Use `.convex.site` for app/HTTP endpoint traffic.
- `.convex.cloud` may still appear in dashboard tooling; both can exist.

## Production-First Local Workflow

If working against production:

```bash
CONVEX_DEPLOYMENT=prod:tremendous-jaguar-953
VITE_CONVEX_URL=https://tremendous-jaguar-953.convex.cloud
VITE_CONVEX_SITE_URL=https://tremendous-jaguar-953.convex.site
```

Run frontend only:

```bash
bun run dev:frontend
```

Avoid:
- `convex dev` while targeting production, since it can overwrite local env defaults.

## Deploy Backend Changes

After editing `convex/*`:

```bash
bun run deploy:convex
```

(`package.json` maps this to `convex deploy`)

## Vercel Build Notes

- Frontend build command is `bun run build` (Vite build only).
- Do not run `convex dev --once` in Vercel build.
- Convex deploy and Vercel deploy are separate steps.

## Environment Variables Split

Convex env (backend/runtime):
- `INGEST_API_KEY`
- `DISCORD_STATUS_WEBHOOK_URL`
- `OPEN_ROUTER_KEY` / `OPENROUTER_API_KEY`
- `FAL_KEY`

Frontend/Vercel env (build/runtime in browser):
- `VITE_CONVEX_URL`
- `VITE_CONVEX_SITE_URL` (if used by frontend tooling)

Discord bot env (separate process):
- `DISCORD_TOKEN`, `DISCORD_CLIENT_ID`, `DISCORD_GUILD_ID`
- `PINDECK_USER_ID`
- `INGEST_API_KEY`
- `CONVEX_SITE_URL` or explicit `PINDECK_INGEST_URL` / moderation URLs

## Commands Reference

| Command | Purpose |
|---|---|
| `bun run dev:frontend` | Frontend local dev |
| `bun run build` | Frontend production build |
| `bun run deploy:convex` | Deploy Convex backend |
| `bun run discord:bot` | Run Discord bot process |

## Caution

- Vercel does not host the Discord bot websocket worker.
- Discord bot must run as an always-on separate worker service.
