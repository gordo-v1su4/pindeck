---
description: Current project structure and feature map for Pindeck (React + Convex + Discord bot)
globs: **/*
alwaysApply: true
---
# Pindeck Project Structure

This file is the quick map of what exists in the repo today.

## Project Overview

Pindeck is an image curation app with:
- React + TypeScript frontend
- Convex backend (auth, data, storage, HTTP endpoints)
- Discord ingest/moderation bot (Bun process)
- AI analysis + variation generation pipeline

Current behavior highlights:
- Discord imports are queued (`pending`) and manually approved/denied.
- Discord-origin generated children are also queued and keep lineage (`parentImageId`) and `sref`.
- Upload flow separates pending/processing/draft/active states.
- Gallery has a view toggle plus Sref-only toggle.
- Table view has advanced filters, parent navigation, original-only and Sref-only toggles.

## Root Structure

```text
pindeck/
├── .cursor/rules/                 # Cursor rules/docs
├── convex/                        # Convex backend
├── docs/                          # Session docs/notes
├── scripts/                       # Run/deploy helper scripts
├── services/discord-bot/          # Discord bot service
├── src/                           # Frontend app
├── package.json
└── README.md
```

## Backend (`convex/`)

Key files:
- `schema.ts`: tables/indexes (`images`, `profiles`, `importBatches`, boards/decks/storyboards, etc.)
- `images.ts`: CRUD, ingest HTTP routes, queue/moderation logic, generated-image save, metadata updates
- `vision.ts`: analysis + variation generation flow and prompt planning
- `discordNotifications.ts`: webhook status events to Discord channel
- `http.ts`: public HTTP routes (`/ingestExternal`, `/discordQueue`, `/discordModerate`, `/smartAnalyzeImage`)
- `boards.ts`, `generations.ts`, `decks.ts`, `storyboards.ts`: output/organization features

Important image fields:
- `status`: `pending` / `draft` / `active`
- `aiStatus`: `queued` / `processing` / `completed` / `failed`
- `sourceType`: `upload` / `discord` / `pinterest` / `ai`
- `sref`, `tags`, `colors`, `group`, `projectName`, `parentImageId`

## Frontend (`src/`)

Key files:
- `App.tsx`: tabs, top-level state, gallery/upload/boards/table routes
- `components/ImageGrid.tsx`: gallery views, Sref-only toggle, project rows, quick actions
- `components/ImageUploadForm.tsx`: local upload + Discord queue review/approve/discard
- `components/TableView.tsx`: sortable/filterable table, parent navigation, original/sref toggles
- `components/ImageModal.tsx`: image details, sref copy, parent linkage
- `components/GenerateVariationsModal.tsx`: explicit post-review variation settings
- `components/CategoryFilter.tsx`: category filter tabs
- `lib/colorExtraction.ts`: frontend color extraction helper

## Discord Bot (`services/discord-bot/`)

Key file:
- `src/index.js`

Capabilities:
- Slash commands for presets and ingest workflows.
- Queue review and moderation commands/buttons.
- Reaction-triggered ingest from channel messages and RSS-forwarded posts.
- Auto variation-control buttons on approved status messages.
- Talks to Convex HTTP endpoints with API key auth.

Runtime model:
- Separate long-running process (not hosted by Vercel frontend).

## Scripts

Common scripts:
- `bun run dev:frontend`
- `bun run dev:backend` (avoid when targeting production data)
- `bun run build` (frontend build)
- `bun run deploy:convex`
- `bun run discord:bot`

## Current Conventions

- Keep production Convex usage explicit; avoid accidental `convex dev` when working on prod.
- For Discord ingest/moderation updates, update both:
  - Convex HTTP/backend behavior
  - `services/discord-bot/src/index.js`
- Keep lineage consistent:
  - generated images must keep `parentImageId`
  - Discord lineage keeps `sref` from parent/root
- Prefer manual approval queue for Discord-ingested content before expensive AI steps.
