---
description: Project directory structure and important files overview for the Visuals image gallery application
globs: **/*
alwaysApply: true
---
# Visuals Project Structure

This rule outlines the directory structure and organization of the **Visuals** project - a React/TypeScript image gallery and sharing platform built with Convex backend.

## Project Overview

**Visuals** is a curated image gallery and sharing platform that provides:
- User authentication with Convex Auth
- Image upload, search, and categorization
- Pinterest-style boards and collections
- Advanced table view with filtering and sorting
- AI-powered image analysis using Gemini 3 Pro (automatic title, description, tags, colors, category detection)
- AI image generation with random shot type variation (9 cinematic shot types)
- Automatic color extraction from images
- Social features (likes, collections, views)
- Responsive masonry layout with Radix UI + Tailwind CSS
- Real-time updates via Convex subscriptions
- TypeScript-first development experience

## Root Directory Structure

```
pindeck/
â”œâ”€â”€ ðŸ“ .cursor/           # ðŸ› ï¸ Development rules & guidelines
â”œâ”€â”€ ðŸ“ convex/           # ðŸ—„ï¸ Backend & database (Convex)
â”œâ”€â”€ ðŸ“ src/             # ðŸŽ¨ Frontend application (React/TypeScript)
â”œâ”€â”€ ðŸ“ dist/            # ðŸ“¦ Build output (generated)
â”œâ”€â”€ ðŸ“ node_modules/    # ðŸ“š Dependencies (not tracked)
â”œâ”€â”€ ðŸ“„ package.json     # ðŸ“‹ Project configuration
â”œâ”€â”€ ðŸ“„ README.md        # ðŸ“– Project documentation
â””â”€â”€ ðŸ“„ *.config.*       # âš™ï¸ Build & development configs
```

## Cursor Rules Directory (`/.cursor/`)

**Purpose**: Development guidelines, coding standards, and project-specific rules for Cursor IDE.

```
.cursor/
â””â”€â”€ rules/
    â”œâ”€â”€ cursor-rules.mdc         # ðŸ“ Rules management guide
    â”œâ”€â”€ project-structure.mdc    # ðŸ—‚ï¸ This file (structure guide)
    â”œâ”€â”€ tech-stack.mdc           # ðŸ› ï¸ Technology stack and dependencies
    â”œâ”€â”€ radix-ui-patterns.mdc    # ðŸŽ¨ Radix UI component patterns and gotchas
    â””â”€â”€ self-improve.mdc         # ðŸ”„ Continuous improvement guidelines
```

## Convex Backend Directory (`/convex/`)

**Purpose**: Server-side logic, database schema, and API endpoints using Convex framework.

```
convex/
â”œâ”€â”€ ðŸ“ _generated/              # ðŸ¤– Auto-generated files
â”‚   â”œâ”€â”€ api.d.ts               # TypeScript API definitions
â”‚   â”œâ”€â”€ api.js                 # JavaScript API functions
â”‚   â”œâ”€â”€ dataModel.d.ts         # Database model types
â”‚   â”œâ”€â”€ server.d.ts            # Server-side types
â”‚   â””â”€â”€ server.js              # Server-side code
â”‚
â”œâ”€â”€ auth.config.ts             # ðŸ” Authentication configuration
â”œâ”€â”€ auth.ts                    # ðŸ‘¤ Authentication logic
â”œâ”€â”€ boards.ts                  # ðŸ“Œ Pinterest-style boards API
â”œâ”€â”€ debug.ts                   # ðŸ› Debug utilities
â”œâ”€â”€ http.ts                    # ðŸŒ HTTP utilities & external APIs
â”œâ”€â”€ images.ts                  # ðŸ–¼ï¸ Image CRUD, search, likes, color extraction API
â”œâ”€â”€ router.ts                  # ðŸ›£ï¸ API route definitions
â”œâ”€â”€ schema.ts                  # ðŸ“Š Database schema & indexes
â”œâ”€â”€ seed.ts                    # ðŸŒ± Database seeding script
â”œâ”€â”€ vision.ts                  # ðŸ¤– AI image analysis & generation (Gemini 3 Pro)
â””â”€â”€ tsconfig.json              # âš™ï¸ Backend TypeScript config
```

## Source Directory (`/src/`)

**Purpose**: Frontend React application with TypeScript, featuring image gallery components and user authentication.

```
src/
â”œâ”€â”€ ðŸ“ components/             # ðŸ§© Reusable React components
â”‚   â”œâ”€â”€ BoardsView.tsx        # ðŸ“Œ Pinterest-style boards management
â”‚   â”œâ”€â”€ CategoryFilter.tsx    # ðŸ·ï¸ Category filtering UI
â”‚   â”œâ”€â”€ CreateBoardModal.tsx  # âž• Board creation modal
â”‚   â”œâ”€â”€ ImageGrid.tsx         # ðŸŽ¯ Main image display (masonry with hover effects)
â”‚   â”œâ”€â”€ ImageModal.tsx        # ðŸ” Image detail modal (transparent backdrop, tag colors, soft buttons)
â”‚   â”œâ”€â”€ ImageUploadForm.tsx   # ðŸ“¤ Multi-image upload with AI analysis trigger
â”‚   â”œâ”€â”€ SearchBar.tsx         # ðŸ”Ž Search functionality (soft variant styling)
â”‚   â””â”€â”€ TableView.tsx         # ðŸ“Š Advanced data table (ID column, tag colors, blue theme)
â”‚
â”œâ”€â”€ ðŸ“ lib/                   # ðŸ› ï¸ Utilities & helpers
â”‚   â”œâ”€â”€ colorExtraction.ts    # ðŸŽ¨ Browser-based color extraction
â”‚   â””â”€â”€ utils.ts              # ðŸŽ¨ Tailwind CSS utilities & tag color mapping
â”‚
â”œâ”€â”€ App.tsx                   # ðŸŽª Main application component with tabs
â”œâ”€â”€ index.css                 # ðŸŽ¨ Global styles & Tailwind
â”œâ”€â”€ main.tsx                  # ðŸš€ Application entry point with Radix Theme
â”œâ”€â”€ SignInForm.tsx            # ðŸ“ User authentication form
â”œâ”€â”€ SignOutButton.tsx         # ðŸšª Sign-out functionality
â””â”€â”€ vite-env.d.ts             # âš™ï¸ Vite environment types
```

## Components Directory (`/src/components/`)

**Purpose**: Modular React components for the image gallery interface.

```
src/components/
â”œâ”€â”€ BoardsView.tsx           # ðŸ“Œ Pinterest-style boards management
â”œâ”€â”€ CategoryFilter.tsx       # ðŸ·ï¸ Filter images by category
â”œâ”€â”€ CreateBoardModal.tsx     # âž• Board creation modal
â”œâ”€â”€ ImageGrid.tsx            # ðŸŽ¯ Responsive masonry grid layout
â”œâ”€â”€ ImageModal.tsx           # ðŸ” Full-screen image viewer with colors
â”œâ”€â”€ ImageUploadForm.tsx      # ðŸ“¤ Multi-image upload with color extraction
â”œâ”€â”€ SearchBar.tsx            # ðŸ”Ž Real-time search interface
â””â”€â”€ TableView.tsx            # ðŸ“Š Advanced data table with filtering
```

## Build Output Directory (`/dist/`)

**Purpose**: Production-ready build artifacts generated by Vite.

```
dist/
â”œâ”€â”€ index.html               # ðŸ“„ Main HTML template
â””â”€â”€ assets/                  # ðŸ“¦ Compiled bundles
    â”œâ”€â”€ index-*.js          # âš¡ Compiled JavaScript
    â””â”€â”€ index-*.css         # ðŸŽ¨ Compiled CSS styles
```

## Key Configuration Files

### Package Management
- `package.json` - ðŸ“¦ Main project dependencies, scripts, and metadata
- `bun.lock` - ðŸ”’ Bun package manager lock file
- `bunfig.toml` - âš™ï¸ Bun configuration

### Build & Development
- `vite.config.ts` - âš¡ Vite build tool configuration
- `tsconfig.json` - ðŸ“˜ Root TypeScript configuration
- `tsconfig.app.json` - ðŸŽ¨ Frontend TypeScript config
- `tsconfig.node.json` - ðŸŸ¢ Node.js TypeScript config

### Code Quality & Styling
- `eslint.config.js` - ðŸ” ESLint linting rules
- `tailwind.config.js` - ðŸŽ¨ Tailwind CSS configuration
- `postcss.config.cjs` - ðŸŽ¯ PostCSS configuration

### Development Tools
- `.gitignore` - ðŸš« Git ignore rules
- `index.html` - ðŸŒ Main HTML template

## Component Organization Patterns

### React Components (`/src/components/`)
- **Functional components**: Modern React hooks-based
- **TypeScript interfaces**: Strongly typed props and state
- **Radix UI components**: Accessible component primitives
- **Tailwind styling**: Utility-first CSS approach
- **Modular exports**: Clean import/export patterns

### Convex Backend (`/convex/`)
- **Query/Mutation pattern**: Convex's reactive data fetching
- **Type safety**: Full TypeScript integration
- **Real-time updates**: Live data synchronization
- **Authentication integration**: User-based data access

## File Naming Conventions

### React Components
- **PascalCase**: `ImageGrid.tsx`, `CategoryFilter.tsx`
- **Descriptive names**: Clear component purpose
- **Consistent suffixes**: `.tsx` for TypeScript React

### Backend Functions
- **camelCase**: `images.ts`, `auth.ts`, `http.ts`
- **Purpose-driven**: API functionality clearly indicated
- **TypeScript**: `.ts` for backend, `.d.ts` for definitions

### Configuration Files
- **kebab-case**: `tailwind.config.js`, `vite.config.ts`
- **Tool-specific**: Standard naming conventions
- **Clear extensions**: `.config.js`, `.config.ts`

## Database Schema Structure

```typescript
// Main data models in convex/schema.ts
const images = {
  title: string,
  description?: string,
  imageUrl: string,
  storageId?: storageId,
  category: string,
  tags: string[],
  source?: string,
  sref?: string,           // Style reference (manually set by user)
  colors?: string[],       // Extracted color palette
  uploadedBy: userId,
  likes: number,
  views: number,
  aiStatus?: string,       // AI processing status: "processing", "completed", "failed"
  status?: string,         // Image status: "draft", "active", "pending"
  uploadedAt?: number,     // Upload timestamp
  parentImageId?: imageId  // Reference to parent image if AI-generated variation
}

const collections = {
  name: string,
  description?: string,
  userId: userId,
  isPublic: boolean,
  imageIds: imageId[]
}

const likes = {
  userId: userId,
  imageId: imageId
}
```

## Key Architectural Patterns

### Frontend Architecture
- **Component Structure**: Modular React components in `src/components/`
- **State Management**: Local state with React hooks, Convex for server state
- **UI Framework**: Radix UI components with Radix Themes
- **Styling**: Tailwind CSS with utility-first approach, consistent blue theme with opacity
- **Data Tables**: TanStack Table for advanced data management (ID column, tag colors)
- **Image Display**: Responsive masonry grid with subtle hover effects
- **Modal Design**: Transparent backdrop, soft buttons, consistent tag colors
- **Authentication**: Convex Auth with protected routes
- **Responsive Design**: Full-width layout, no hard max-width constraints

### Backend Architecture
- **Database**: Convex with defined schema and indexes
- **API Layer**: Generated API functions with type safety
- **Authentication**: Integrated auth system with user management
- **File Storage**: Convex storage for image uploads
- **Boards System**: Pinterest-style collections management
- **AI Integration**: Gemini 3 Pro Image Preview for analysis and generation
  - **Smart Analysis**: Automatic title, description, tags, colors, category, visual style detection
  - **Image Generation**: Creates 2 cinematic variations with random shot type selection (9 shot types)
  - **Memory Optimization**: Chunked base64 conversion, 10MB image size limits
- **Color Extraction**: Automatic color palette generation

### Development Workflow
- **Build Tool**: Vite for fast development and optimized builds
- **Package Manager**: Bun for dependency management
- **Linting**: ESLint with TypeScript support
- **Type Safety**: Full TypeScript coverage across frontend and backend

### AI Features Architecture
- **Image Analysis**: Automatic metadata extraction via Gemini 3 Pro
  - Title, description, tags, colors, category, visual style
  - Processes on upload, updates image record
- **Image Generation**: Creates 2 cinematic variations
  - Random shot type selection (9 types: ELS, LS, MS, MCU, CU, ECU, Low Angle, High Angle, etc.)
  - Memory-optimized (chunked base64, 10MB limit)
  - Configurable aspect ratio and 2K resolution
  - Saves as variations linked to original image
- **Parent Image Lineage**: Suno-style remix links
  - AI variations store `parentImageId` reference to source
  - ImageModal displays "Generated from: [Parent Title]" link
  - TableView has "Parent" column with clickable navigation
  - Cross-component navigation via custom events
- **Original Image Tagging**: Auto-tagging system
  - User uploads automatically tagged with "original"
  - AI-generated variations excluded from "original" tag
  - TableView filter toggle to show only original images
  - Filter logic: `!parentImageId` OR has "original" tag

## Important Files Reference

```typescript
// Main entry point
[src/main.tsx](mdc:src/main.tsx)

// Core application logic
[src/App.tsx](mdc:src/App.tsx)

// Database schema
[convex/schema.ts](mdc:convex/schema.ts)

// Authentication setup
[convex/auth.config.ts](mdc:convex/auth.config.ts)

// Image management API
[convex/images.ts](mdc:convex/images.ts)

// Boards management API
[convex/boards.ts](mdc:convex/boards.ts)

// AI vision & image generation
[convex/vision.ts](mdc:convex/vision.ts)
```

## File Organization Guidelines

### âœ… Good: Consistent Structure
```
src/
â”œâ”€â”€ components/     # UI components
â”œâ”€â”€ lib/           # Utilities and helpers
â”œâ”€â”€ main.tsx       # Entry point
â””â”€â”€ App.tsx        # Main app component
```

### âŒ Bad: Mixed Organization
```
src/
â”œâ”€â”€ utils.ts       # Should be in lib/
â”œâ”€â”€ Header.tsx     # Should be in components/
â””â”€â”€ api/           # Should follow backend patterns
```

## UI Design Patterns & Styling Conventions

> **See also:** [radix-ui-patterns.mdc](mdc:.cursor/rules/radix-ui-patterns.mdc) for detailed Radix UI component patterns and gotchas.

### Color Theme
- **Primary Color**: Blue (matching top navigation)
- **Button Opacity**: Never 100% - use 0.7-0.9 for soft buttons, 1.0 only for selected states
- **Tag Colors**: Use `getTagColor()` utility for consistent tag coloring across table and modal
- **Sref Badges**: Blue color (not purple)

### Modal Design
- **Transparent Backdrop**: `bg-black/60 backdrop-blur-md` for bottom panel (matches header)
- **No Image Borders**: Images display with transparent background
- **Soft Buttons**: Like/Save buttons use `variant="soft"` with opacity
- **Tag Consistency**: Tags use same color system as table view

### Responsive Design
- **Full Width**: No hard `max-w-7xl` constraints - use `w-full` with responsive padding
- **Responsive Padding**: `px-4 sm:px-6 lg:px-8` for adaptive spacing
- **Table**: Horizontal scroll on small screens, full width on large screens

### Hover Effects
- **Subtle Text**: Use `text-gray-11` instead of bright white
- **Icon Blending**: Icons use `text-gray-10` with backdrop blur
- **Smooth Transitions**: All hover effects use `transition-opacity duration-200`

## Navigation Tips

- Start with `src/App.tsx` for understanding the application flow
- Check `convex/schema.ts` for data models and relationships
- Review `package.json` for available scripts and dependencies
- Use `src/components/` for understanding UI patterns
- Check `convex/vision.ts` for AI integration patterns
- Reference `.cursor/rules/` for development guidelines